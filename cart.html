<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="./src/style.css" />
    <link rel="stylesheet" href="./src/cart.css" />
    <link rel="stylesheet" href="./fontawesome-free-6.0.0-web/css/all.min.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
      integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>

  <body>
    <div class="root">
      <div class="header" id="header">
        <div class="header-top">
          <div class="container">
            <div>
              <ul class="header-top-info">
                <li>
                  <i class="fa-solid fa-circle-info"></i>
                  <a href="">Help</a>
                </li>
                <li>
                  <i class="fa-solid fa-newspaper"></i>
                  <a href="">News</a>
                </li>
                <li>
                  <i class="fa-solid fa-tags"></i>
                  <a href="">Campain</a>
                </li>
              </ul>
              <ul class="header-top-login">
                <li>
                  <i class="fa-solid fa-gift"></i>
                  <a href="">Voucher</a>
                </li>
                <li>
                  <i class="fa-solid fa-clipboard-check"></i>
                  <a href="">Check</a>
                </li>
                <li>
                  <i class="fa-solid fa-arrow-right-to-bracket"></i>
                  <a href="">Log in</a>
                </li>
                <li>
                  <i class="fa-solid fa-user-large"></i>
                  <a href="">Register</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="header-search">
          <div class="container">
            <div>
              <div class="header-search-logo">
                <a href="./index.html"><img src="./img/homepage/logo.png" alt="" /></a>
              </div>
              <div class="header-search-input">
                <select name="" id="">
                  <option value="All">All</option>
                  <option value="Helpself Books">Helpself Books</option>
                  <option value="Japanese Books">Japanese Books</option>
                  <option value="English Books">English Books</option>
                  <option value="Chinese Books">Chinese Books</option>
                  <option value="Korean Books">Korean Books</option>
                </select>
                <input type="text" placeholder="What do you need?" />
                <div><i class="fa-solid fa-magnifying-glass"></i></div>
              </div>
              <div class="header-search-hotline">
                <i class="fa-solid fa-square-phone-flip"></i>
                <div>
                  <span>070-8987-2493</span>
                  <p>Hotline</p>
                </div>
              </div>
              <div class="header-search-cart">
                <a href="./cart.html">
                  <i class="fa-solid fa-cart-shopping"></i>
                  <span>Cart</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="content">
        <div class="container">
          <div class="wrapper">
            <div class="shopping-cart">
              <div class="shopping-cart-title">
                <h1>SHOPPING CART</h1>
                <button>Select All</button>
                <p>Prices</p>
              </div>
              <div class="shopping-cart-item">
                <div class="shopping-cart-item-check">
                  <input type="checkbox" />
                </div>
                <div class="shopping-cart-item-image">
                  <img src="./img/homepage/N1.14.jpg" alt="" />
                </div>
                <div class="shopping-cart-item-info">
                  <h3>N1 Exam Book</h3>
                  <p>Author: abc</p>
                  <span>Quantity:</span>
                  <input value="1" type="number" min="1" />
                </div>
                <div class="shopping-cart-item-price">
                  <p>1500</p>
                  <span>円</span>
                </div>
              </div>
              <div class="shopping-cart-item">
                <div class="shopping-cart-item-check">
                  <input type="checkbox" />
                </div>
                <div class="shopping-cart-item-image">
                  <img
                    src="./img/product/helpself/tranh-truyen-lich-su-viet-nam-thanh-thai_117869_1.jpg"
                    alt=""
                  />
                </div>
                <div class="shopping-cart-item-info">
                  <h3>Tranh-truyen-lich-su-viet-nam-thanh-thai</h3>
                  <p>Author: abc</p>
                  <span>Quantity:</span>
                  <input value="1" type="number" min="1" />
                </div>
                <div class="shopping-cart-item-price">
                  <p>2500</p>
                  <span>円</span>
                </div>
              </div>
              <div class="shopping-cart-item">
                <div class="shopping-cart-item-check">
                  <input type="checkbox" />
                </div>
                <div class="shopping-cart-item-image">
                  <img
                    src="./img/product/helpself/tranh-truyen-lich-su-viet-nam-thanh-thai_117869_1.jpg"
                    alt=""
                  />
                </div>
                <div class="shopping-cart-item-info">
                  <h3>Tranh-truyen-lich-su-viet-nam-thanh-thai</h3>
                  <p>Author: abc</p>
                  <span>Quantity:</span>
                  <input value="1" type="number" min="1" />
                </div>
                <div class="shopping-cart-item-price">
                  <p>2300</p>
                  <span>円</span>
                </div>
              </div>
              <div class="shopping-cart-item">
                <div class="shopping-cart-item-check">
                  <input type="checkbox" />
                </div>
                <div class="shopping-cart-item-image">
                  <img
                    src="./img/product/helpself/tranh-truyen-lich-su-viet-nam-thanh-thai_117869_1.jpg"
                    alt=""
                  />
                </div>
                <div class="shopping-cart-item-info">
                  <h3>Tranh-truyen-lich-su-viet-nam-thanh-thai</h3>
                  <p>Author: abc</p>
                  <span>Quantity:</span>
                  <input value="1" type="number" min="1" />
                </div>
                <div class="shopping-cart-item-price">
                  <p>1800</p>
                  <span>円</span>
                </div>
              </div>
              <div class="shopping-cart-item">
                <div class="shopping-cart-item-check">
                  <input type="checkbox" />
                </div>
                <div class="shopping-cart-item-image">
                  <img
                    src="./img/product/helpself/tranh-truyen-lich-su-viet-nam-thanh-thai_117869_1.jpg"
                    alt=""
                  />
                </div>
                <div class="shopping-cart-item-info">
                  <h3>Tranh-truyen-lich-su-viet-nam-thanh-thai</h3>
                  <p>Author: abc</p>
                  <span>Quantity:</span>
                  <input value="1" type="number" min="1" />
                </div>
                <div class="shopping-cart-item-price">
                  <p>1780</p>
                  <span>円</span>
                </div>
              </div>
            </div>
            <div class="order">
              <div class="subtotal">
                <span>SubTotal</span>
                <span class="Total-quantity"></span>
                <span class="Total-money"></span>
              </div>
              <div class="buy-btn">
                <a href="./buy.html">
                  <button>BUY</button>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      var inputPrices = document.querySelectorAll(".shopping-cart-item-info input");
      var checkItems = document.querySelectorAll(".shopping-cart-item-check input");
      var sumElement = document.querySelector(".Total-money");
      var quantityElement = document.querySelector(".Total-quantity");
      var listPrice = document.querySelectorAll(".shopping-cart-item-price p");

      for (var i = 0; i < inputPrices.length; i++) {
        const priceValue = Number(listPrice[i].innerHTML);
        inputPrices[i].onchange = function () {
          var price = this.parentElement.parentElement.querySelector(".shopping-cart-item-price p");
          price.innerHTML = this.value * priceValue;
        };
      }

      function hadleCaculatorPlus(listItem, selector) {
        return Array.from(listItem)
          .filter((ele) => {
            return ele.parentElement.parentElement.querySelector(selector).checked;
          })
          .reduce((total, ele) => {
            return total + (Number(ele.value) || Number(ele.innerHTML));
          }, 0);
      }

      function handleCaculator(that) {
        var check = true;
        //element số lượng ứng mỗi sản phẩm
        var quantity = that.parentElement.parentElement.querySelector(
          ".shopping-cart-item-info input"
        );
        //element giá ứng với mỗi sản phẩm
        var price = that.parentElement.parentElement.querySelector(".shopping-cart-item-price p");

        //Giá của sản phẩm
        var priceValue = Number(price.innerHTML);
        if (that.checked && check == true) {
          price.setAttribute("check", check);
          quantity.onchange = (e) => {
            //Kjhi thay đổi số lươnng thì giá của sp thay đổi theo
            price.innerHTML = priceValue * e.target.value;

            //Tổng tiền tất cả sản phẩm khi thay đổi số lượng của mỗi sp
            sumElement.innerHTML = hadleCaculatorPlus(listPrice, ".shopping-cart-item-check input");

            //Tổng số lượng tất cả sp khi số lượng của mỗi sp thay đổi
            quantityElement.innerHTML = hadleCaculatorPlus(
              inputPrices,
              ".shopping-cart-item-check input"
            );
          };

          //Tổng tiền khi đc check
          sumElement.innerHTML = hadleCaculatorPlus(
            listPrice,
            ".shopping-cart-item-check input",
            check
          );

          //Tổng sl khi đc check
          quantityElement.innerHTML = hadleCaculatorPlus(
            inputPrices,
            ".shopping-cart-item-check input",
            check
          );
          //Khi sản phẩm đc check và thay đổi số lượng
        } else if (!that.checked) {
          //Nếu tắt check
          check = false;
          price.setAttribute("check", check);
          var sumValue = Number(sumElement.innerHTML);
          sumElement.innerHTML = sumValue - Number(price.innerHTML);

          var quantityValue = Number(quantityElement.innerHTML);

          quantityElement.innerHTML =
            quantityValue -
            price.parentElement.parentElement.querySelector(".shopping-cart-item-info input").value;
        }
      }
      for (var i = 0; i < checkItems.length; i++) {
        //Thay đổi check box(đc check hoặc k đc check)
        checkItems[i].onchange = function () {
          handleCaculator(this);
        };
      }

      var selectAllBtn = document.querySelector(".shopping-cart-title button");
      var isSelectedAll = false;
      selectAllBtn.onclick = function () {
        isSelectedAll = !isSelectedAll;
        if (isSelectedAll) {
          for (var i = 0; i < checkItems.length; i++) {
            selectAllBtn.innerHTML = "UnSelectAll";
            checkItems[i].checked = true;
            handleCaculator(checkItems[i]);
          }
        } else {
          for (var i = 0; i < checkItems.length; i++) {
            checkItems[i].checked = false;
            sumElement.innerHTML = 0;
            quantityElement.innerHTML = 0;
            selectAllBtn.innerHTML = "SelectAll";
          }
        }
      };
    </script>
  </body>
</html>
